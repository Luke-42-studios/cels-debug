---
phase: 02-tab-system-and-overview
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - tools/cels-debug/src/tabs/tab_overview.h
  - tools/cels-debug/src/tabs/tab_overview.c
  - tools/cels-debug/src/tab_system.c
  - tools/cels-debug/CMakeLists.txt
autonomous: false

must_haves:
  truths:
    - "Overview tab (tab 1) displays entity count, system count, FPS, and frame time from live data"
    - "When connected to a running CELS app, Overview dashboard numbers update every poll cycle"
    - "When no data is available yet, Overview shows 'Waiting for data...' centered in the content area"
    - "Overview tab matches the stats that Phase 01 displayed (entity count, FPS, frame time, system count) -- no data regression"
  artifacts:
    - path: "tools/cels-debug/src/tabs/tab_overview.h"
      provides: "Overview tab function declarations (init, fini, draw, input)"
      contains: "tab_overview_draw"
    - path: "tools/cels-debug/src/tabs/tab_overview.c"
      provides: "Overview dashboard rendering with entity count, system count, FPS, frame time"
      contains: "Entities"
    - path: "tools/cels-debug/src/tab_system.c"
      provides: "Overview tab wired into tab_defs[0] instead of placeholder"
      contains: "tab_overview_init"
  key_links:
    - from: "tools/cels-debug/src/tabs/tab_overview.c"
      to: "tools/cels-debug/src/data_model.h"
      via: "casts void* app_state to app_state_t*, reads snapshot->entity_count, fps, frame_time_ms, system_count"
      pattern: "state->snapshot->entity_count"
    - from: "tools/cels-debug/src/tab_system.c"
      to: "tools/cels-debug/src/tabs/tab_overview.h"
      via: "tab_defs[0] uses tab_overview_init/fini/draw/input instead of placeholder"
      pattern: "tab_overview_init"
---

<objective>
Implement the Overview tab that displays a live dashboard with entity count, system count, FPS, and frame time. This moves the Phase 01 inline stats rendering from tui.c into a proper tab implementation and wires it into the tab system as tab slot 0.

Purpose: The Overview tab is the default landing view. It provides immediate value -- the user sees live ECS metrics the moment cels-debug launches and connects. This completes Phase 02's user-facing goal.

Output: A working Overview tab at position 1 showing entity count, system count, FPS, and frame time from world_snapshot_t data, with a "Waiting for data..." fallback when disconnected.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@tools/cels-debug/.planning/PROJECT.md
@tools/cels-debug/.planning/ROADMAP.md
@tools/cels-debug/.planning/STATE.md
@tools/cels-debug/.planning/phases/02-tab-system-and-overview/02-RESEARCH.md
@tools/cels-debug/.planning/phases/02-tab-system-and-overview/02-01-SUMMARY.md

Source files from Plan 01 (these must exist before this plan runs):
@tools/cels-debug/src/tab_system.h
@tools/cels-debug/src/tab_system.c
@tools/cels-debug/src/tui.h
@tools/cels-debug/src/tui.c
@tools/cels-debug/src/data_model.h
@tools/cels-debug/CMakeLists.txt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement Overview tab and wire into tab system</name>
  <files>
    tools/cels-debug/src/tabs/tab_overview.h
    tools/cels-debug/src/tabs/tab_overview.c
    tools/cels-debug/src/tab_system.c
    tools/cels-debug/CMakeLists.txt
  </files>
  <action>
Create 2 new files and modify 2 existing files:

**tabs/tab_overview.h** -- Header for the Overview tab:
- Include guard: `CELS_DEBUG_TAB_OVERVIEW_H`.
- Include `"../tab_system.h"` (for tab_t, WINDOW forward decl).
- Declare 4 functions: `tab_overview_init(tab_t *self)`, `tab_overview_fini(tab_t *self)`, `tab_overview_draw(const tab_t *self, WINDOW *win, const void *app_state)`, `tab_overview_input(tab_t *self, int ch, void *app_state)`.

**tabs/tab_overview.c** -- Implementation. This moves the Phase 01 content rendering from the old tui_render into the tab pattern:
- Include `"tab_overview.h"`, `"../tui.h"` (for app_state_t), and `<ncurses.h>`.
- `tab_overview_init`: `self->state = NULL;` (no per-tab state needed for Overview).
- `tab_overview_fini`: no-op, void cast self.
- `tab_overview_draw`: This is the core function. Cast `app_state` to `const app_state_t*`. If `state->snapshot` is not NULL, render the dashboard. Use the SAME color pair `CP_LABEL` (value 4, defined in tui.c -- since tui.c already init_pair'd it). Wait: CP_LABEL is `#define CP_LABEL 4` in tui.c, but it is NOT exposed in tui.h. Two options: (a) duplicate the define in tab_overview.c, or (b) expose it from tui.h. Option (b) is cleaner -- add `#define CP_LABEL 4` to tui.h (or an `extern` -- but for a #define there is no extern needed, just put the define in tui.h and remove it from tui.c). Actually, the cleanest approach: move all CP_* defines from tui.c to tui.h so tabs can use them. The defines are: CP_CONNECTED=1, CP_DISCONNECTED=2, CP_RECONNECTING=3, CP_LABEL=4, CP_TAB_ACTIVE=5, CP_TAB_INACTIVE=6.

    So: ALSO modify tui.h to add the CP_* defines, and remove them from tui.c.

    Dashboard layout in the content window:
    ```
    Row 1, col 2:  "Entities:   <value>"
    Row 2, col 2:  "FPS:        <value>"
    Row 3, col 2:  "Frame time: <value> ms"
    Row 4, col 2:  "Systems:    <value>"
    ```
    Use `wattron(win, COLOR_PAIR(CP_LABEL))` for labels, `wattroff` after, then `wprintw` for values. This matches exactly what Phase 01 tui.c rendered.

    If `state->snapshot` is NULL: center "Waiting for data..." both horizontally and vertically in the content window using `getmaxy(win)/2` and `(getmaxx(win) - 19)/2`. Exactly as Phase 01 did.

- `tab_overview_input`: return false. Overview has no interactive elements. Void cast all params.

**tab_system.c** -- Swap Overview slot from placeholder to real implementation:
- Add `#include "tabs/tab_overview.h"` at the top (alongside the existing `#include "tabs/tab_placeholder.h"`).
- In the `tab_defs[TAB_COUNT]` array, change index 0 from placeholder functions to: `{ "Overview", ENDPOINT_STATS_WORLD, tab_overview_init, tab_overview_fini, tab_overview_draw, tab_overview_input }`.
- All other 5 slots remain using placeholder functions.

**CMakeLists.txt** -- Add the new source file:
- Add `src/tabs/tab_overview.c` to the `add_executable` source list.

**tui.h** -- Move color pair defines:
- Add defines: `#define CP_CONNECTED 1`, `#define CP_DISCONNECTED 2`, `#define CP_RECONNECTING 3`, `#define CP_LABEL 4`, `#define CP_TAB_ACTIVE 5`, `#define CP_TAB_INACTIVE 6`.
- Place them after the includes, before the function declarations.

**tui.c** -- Remove duplicated color pair defines:
- Remove `#define CP_CONNECTED 1` through `#define CP_TAB_INACTIVE 6` from tui.c (they now live in tui.h which tui.c already includes).
  </action>
  <verify>
Build:
```bash
cd /home/cachy/workspaces/libs/cels && cd build && cmake .. -DCELS_DEBUG=ON -DCELS_BUILD_TOOLS=ON 2>&1 | tail -5 && make cels-debug 2>&1 | tail -20
```
Expected: compiles with 0 errors, 0 warnings.

Functional test (requires running CELS app):
```bash
cd /home/cachy/workspaces/libs/cels && ./run.sh both
```
- Overview tab (tab 1) should display entity count, FPS, frame time, system count -- same data as Phase 01.
- Switch to tab 2-6: shows "Not implemented yet".
- Switch back to tab 1: Overview dashboard with live data.
  </verify>
  <done>
Overview tab renders entity count, system count, FPS, and frame time from live world_snapshot_t data. "Waiting for data..." shown when snapshot is NULL. Tab system wires Overview as tab 0. All other tabs remain placeholder. Color pair defines shared via tui.h. Project builds cleanly.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Phase 02: Tab system framework with 6 tabs, tab bar UI, keyboard navigation, and Overview dashboard showing live ECS metrics.</what-built>
  <how-to-verify>
1. Build and run both the CELS app and cels-debug:
   ```bash
   cd /home/cachy/workspaces/libs/cels && ./run.sh both
   ```
   (If run.sh doesn't support "both", run the app in one terminal and cels-debug in another.)

2. Verify tab bar:
   - Row 1 should show: " 1:Overview  2:Entities  3:Components  4:Systems  5:State  6:Performance "
   - "1:Overview" should be highlighted (reverse video / bold)

3. Verify Overview dashboard (tab 1):
   - Content area shows: Entities count, FPS value, Frame time in ms, Systems count
   - Values should update every ~500ms (you'll see FPS fluctuate slightly)

4. Verify tab switching:
   - Press 2: tab bar highlights "2:Entities", content shows "Not implemented yet" with "Entities" below in dim
   - Press 3-6: same behavior for each placeholder tab
   - Press TAB multiple times: cycles forward through all 6 tabs, wraps from 6 back to 1
   - Press 1: returns to Overview with live data

5. Verify connection status:
   - Header shows "cels-debug | Connected" (green) while app is running
   - Kill the CELS app: header should transition to "Reconnecting..." then "Disconnected"
   - Restart the CELS app: should reconnect and show "Connected" again

6. Verify clean exit:
   - Press q: terminal should be restored cleanly (no garbled output)

7. Verify footer:
   - Bottom line shows: "1-6:tabs  TAB:next  q:quit"
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. `cmake --build build --target cels-debug` compiles with 0 errors
2. Overview tab displays entity count, system count, FPS, frame time with live data
3. Overview shows "Waiting for data..." when disconnected
4. Tab 1 rendering matches Phase 01 output (same labels, same data, same color pairs)
5. Tab switching still works (1-6, TAB) after Overview wired in
6. Placeholder tabs still show "Not implemented yet"
7. Connection status in header remains accurate across tab switches
</verification>

<success_criteria>
- Overview tab renders live dashboard: entity count, system count, FPS, frame time
- Overview tab is the default (active on launch)
- Data updates every poll cycle when connected
- "Waiting for data..." fallback when no snapshot available
- No rendering regressions from Phase 01
- Phase 02 success criteria 5 is met: "Overview tab displays dashboard: entity count, system count, FPS, frame time"
</success_criteria>

<output>
After completion, create `.planning/phases/02-tab-system-and-overview/02-02-SUMMARY.md`
</output>
